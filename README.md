# strava-gpx-tool

Tool for **manipulating GPX files for Strava**:

- setting time
- setting heart rate
- merging two files

## How to use it

**Input**: GPX file. It must contain waypoints (for example generated by [Google maps](https://maps.google.com) or [Mapy.cz](https://mapy.cz)). It could also contain time tag and possibly heart rate special tag (Garmin `TrackPointExtension/v1`), so it can process files exported from Strava.

**Output**: GPX file in format that could be imported via [Strava upload page](https://www.strava.com/upload/select) to Strava.

This tool operates in two different modes - filling values (time and/or heart rate - could be combined) and merging files.

### Filling values (time and heart rate)

This mode is useful when you have GPX file with missing time or heart rate values and you want add them manually.

**When you want add time, you must specify start and end times (in UTC) and also the pace.**

The timestmap will be written to each waypoint. It is computed regardless of route profile - it is assumed that each part was run in the defined pace and every 200 meters (variable `PAUSE_LIMIT_METERS`) is inserted the pause time (proportionally based on the difference between overall and active times).

Example of filling time values:

```bash
python strava-gpx-tool.py fill input.gpx --pace 4:44 --start-time "2018-09-15 17:53:10" --end-time "2018-09-15 19:39:50"
```

Filling the **heart rate** is similar to filling time and they could be combined. This tool simply adds the defined heart rate to each waypoint.

Example of **filling just heart rate**:

```bash
python strava-gpx-tool.py fill input.gpx --hr 144
```

More sophisticated option is to include the input file from which script loads heart rates based on the timestamp. This is useful when you lost the GPS signal on your route, so you have the wrong position, but correct heart rate. You can combine this option with default `--hr` switch, which will be used for waypoints without HR and without corresponding time from HR file.

Example of **filling heart rate based on input file combined with default HR**:
```bash
python strava-gpx-tool.py fill input.gpx --hr-file input-hr-file.gpx --hr 144
```

### Merging GPX files

This mode reads GPX files from the directory and simply concatenates them to the output. It preserves all waypoint informations. All files from the input directory are merged in order of their names (lexicographically).

Example of merging two files `input-dir/1.gpx` and `input-dir/second.gpx`:

```bash
python strava-gpx-tool.py merge input-dir
```

### Fixing the cluttered GPS

```bash
python strava-gpx-tool.py fix lisen.gpx lisen-fix.gpx 1030 13500 3:59
```

## About

Author: Mira Kvasnica, GPX processing is based on [gpxpy library](https://github.com/tkrajina/gpxpy).